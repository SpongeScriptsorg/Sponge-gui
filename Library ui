-- Sponge Library UI v4.0 - FIXED
-- Black & Yellow theme | Tabs | Anti-kick | Server hopper | Save settings

local Sponge = {}
Sponge.__index = Sponge
Sponge.Version = "4.0.0"

-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- Black & Yellow Theme
local Theme = {
    bg = Color3.fromRGB(10, 10, 10),        -- Pure black
    surface = Color3.fromRGB(18, 18, 18),    -- Dark gray
    surface2 = Color3.fromRGB(25, 25, 25),   -- Slightly lighter
    accent = Color3.fromRGB(255, 215, 0),    -- Bright yellow
    accent2 = Color3.fromRGB(255, 200, 50),   -- Soft yellow
    text = Color3.fromRGB(255, 255, 255),
    textMuted = Color3.fromRGB(180, 180, 180),
    border = Color3.fromRGB(255, 215, 0)     -- Yellow border
}

-- Save/Load functions (with pcall for safety)
local function SaveSettings(data, name)
    local success, err = pcall(function()
        if writefile then
            writefile("Sponge_" .. name .. ".json", HttpService:JSONEncode(data))
            return true
        end
        return false
    end)
    return success
end

local function LoadSettings(name)
    local success, data = pcall(function()
        if readfile then
            return HttpService:JSONDecode(readfile("Sponge_" .. name .. ".json"))
        end
        return nil
    end)
    if success then return data end
    return nil
end

-- Anti-Kick System
local AntiKick = {
    Active = false,
    Connection = nil,
    
    Start = function(self)
        if self.Active then return end
        self.Active = true
        
        -- Anti-idle disconnect
        LocalPlayer.Idled:Connect(function()
            if self.Active then
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end
        end)
        
        -- Simulate small movements every 20 minutes
        spawn(function()
            while self.Active do
                wait(1200) -- 20 minutes
                if self.Active then
                    local char = LocalPlayer.Character
                    if char and char:FindFirstChild("Humanoid") then
                        char.Humanoid:Move(Vector3.new(0.1, 0, 0), true)
                        wait(0.1)
                        char.Humanoid:Move(Vector3.new(0, 0, 0), true)
                    end
                end
            end
        end)
    end,
    
    Stop = function(self)
        self.Active = false
    end
}

-- Server Hopper
local function HopServer()
    local success, result = pcall(function()
        return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?limit=100"))
    end)
    
    if success and result and result.data then
        local servers = {}
        for _, server in ipairs(result.data) do
            if server.playing < server.maxPlayers and server.id ~= game.JobId then
                table.insert(servers, server.id)
            end
        end
        
        if #servers > 0 then
            local randomServer = servers[math.random(1, #servers)]
            TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer, LocalPlayer)
            return true
        end
    end
    return false
end

-- Utility functions
local function new(class, props)
    local obj = Instance.new(class)
    for k, v in pairs(props) do
        pcall(function()
            obj[k] = v
        end)
    end
    return obj
end

local function tween(obj, props, dur)
    local tween = TweenService:Create(obj, TweenInfo.new(dur or 0.2), props)
    tween:Play()
    return tween
end

-- ===========================================
-- MAIN WINDOW
-- ===========================================
function Sponge:Window(opts)
    opts = opts or {}
    
    -- Check if CoreGui exists
    local parent = CoreGui or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    
    -- Main GUI
    local gui = new("ScreenGui", {
        Name = "SpongeLibrary",
        Parent = parent,
        DisplayOrder = 999,
        IgnoreGuiInset = true,
        Enabled = true
    })
    
    -- Main Frame
    local frame = new("Frame", {
        Parent = gui,
        BackgroundColor3 = Theme.bg,
        Size = UDim2.new(0, opts.Width or 580, 0, opts.Height or 400),
        Position = UDim2.new(0.5, -(opts.Width or 580)/2, 0.5, -(opts.Height or 400)/2),
        Active = true,
        ClipsDescendants = true,
        Visible = true
    })
    
    -- Rounded corners
    local corner = new("UICorner", {Parent = frame, CornerRadius = UDim.new(0, 16)})
    
    -- Border
    local stroke = new("UIStroke", {
        Parent = frame,
        Color = Theme.accent,
        Thickness = 2,
        Transparency = 0.3
    })
    
    -- ===========================================
    -- TOP BAR
    -- ===========================================
    local topBar = new("Frame", {
        Parent = frame,
        BackgroundColor3 = Theme.surface,
        Size = UDim2.new(1, 0, 0, 50),
        BorderSizePixel = 0
    })
    
    local topCorner = new("UICorner", {Parent = topBar, CornerRadius = UDim.new(0, 16)})
    
    -- Yellow line
    local yellowLine = new("Frame", {
        Parent = topBar,
        BackgroundColor3 = Theme.accent,
        Size = UDim2.new(1, -20, 0, 2),
        Position = UDim2.new(0, 10, 1, -2),
        BorderSizePixel = 0
    })
    
    -- "return ui" button (center top)
    local returnBtn = new("TextButton", {
        Parent = topBar,
        BackgroundColor3 = Theme.surface2,
        Size = UDim2.new(0, 100, 0, 30),
        Position = UDim2.new(0.5, -50, 0.5, -15),
        Text = "‚Ü© return ui",
        TextColor3 = Theme.accent,
        Font = Enum.Font.GothamBold,
        TextSize = 14,
        AutoButtonColor = false,
        BackgroundTransparency = 0
    })
    
    local returnCorner = new("UICorner", {Parent = returnBtn, CornerRadius = UDim.new(0, 8)})
    local returnStroke = new("UIStroke", {Parent = returnBtn, Color = Theme.accent, Thickness = 1})
    
    -- Hover effect
    returnBtn.MouseEnter:Connect(function()
        tween(returnBtn, {BackgroundColor3 = Theme.accent}, 0.15)
        tween(returnBtn, {TextColor3 = Theme.bg}, 0.15)
    end)
    
    returnBtn.MouseLeave:Connect(function()
        tween(returnBtn, {BackgroundColor3 = Theme.surface2}, 0.15)
        tween(returnBtn, {TextColor3 = Theme.accent}, 0.15)
    end)
    
    returnBtn.MouseButton1Click:Connect(function()
        print("üîô Return to main UI")
        -- You can define what this does
    end)
    
    -- CLOSE BUTTON (Just X)
    local closeBtn = new("TextButton", {
        Parent = topBar,
        BackgroundColor3 = Theme.surface2,
        Size = UDim2.new(0, 36, 0, 36),
        Position = UDim2.new(1, -46, 0.5, -18),
        Text = "‚úï",
        TextColor3 = Theme.accent,
        Font = Enum.Font.GothamBold,
        TextSize = 20,
        AutoButtonColor = false
    })
    
    local closeCorner = new("UICorner", {Parent = closeBtn, CornerRadius = UDim.new(0, 10)})
    
    closeBtn.MouseEnter:Connect(function()
        tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(255, 80, 80), TextColor3 = Color3.new(1,1,1)}, 0.15)
    end)
    
    closeBtn.MouseLeave:Connect(function()
        tween(closeBtn, {BackgroundColor3 = Theme.surface2, TextColor3 = Theme.accent}, 0.15)
    end)
    
    closeBtn.MouseButton1Click:Connect(function()
        tween(frame, {BackgroundTransparency = 1}, 0.2)
        wait(0.2)
        gui:Destroy()
    end)
    
    -- ===========================================
    -- DRAGGABLE (Mobile + Desktop)
    -- ===========================================
    do
        local dragging = false
        local dragStart = nil
        local startPos = nil
        
        topBar.Active = true
        topBar.Selectable = true
        
        topBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or 
               input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = frame.Position
                tween(topBar, {BackgroundColor3 = Theme.surface2}, 0.15)
            end
        end)
        
        topBar.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or 
               input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                tween(topBar, {BackgroundColor3 = Theme.surface}, 0.15)
            end
        end)
        
        UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.Touch or 
               input.UserInputType == Enum.UserInputType.MouseMovement) then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
    end
    
    -- ===========================================
    -- TAB SYSTEM
    -- ===========================================
    local tabContainer = new("Frame", {
        Parent = frame,
        BackgroundColor3 = Theme.surface,
        Size = UDim2.new(1, 0, 0, 45),
        Position = UDim2.new(0, 0, 0, 50),
        BorderSizePixel = 0
    })
    
    local tabCorner = new("UICorner", {Parent = tabContainer, CornerRadius = UDim.new(0, 12)})
    
    local tabButtons = new("Frame", {
        Parent = tabContainer,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 1, 0),
        Position = UDim2.new(0, 10, 0, 0)
    })
    
    local tabLayout = new("UIListLayout", {
        Parent = tabButtons,
        FillDirection = Enum.FillDirection.Horizontal,
        HorizontalAlignment = Enum.HorizontalAlignment.Left,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 8)
    })
    
    -- Pages container
    local pagesContainer = new("Frame", {
        Parent = frame,
        BackgroundColor3 = Theme.surface,
        Size = UDim2.new(1, -20, 1, -115),
        Position = UDim2.new(0, 10, 0, 100),
        BorderSizePixel = 0
    })
    
    local pagesCorner = new("UICorner", {Parent = pagesContainer, CornerRadius = UDim.new(0, 12)})
    local pagesStroke = new("UIStroke", {Parent = pagesContainer, Color = Theme.accent, Thickness = 1, Transparency = 0.5})
    
    -- Window object
    local win = {
        gui = gui,
        frame = frame,
        pagesContainer = pagesContainer,
        pages = {},
        tabs = {},
        currentTab = nil,
        settings = {},
        
        -- Add Tab
        Tab = function(self, name)
            -- Tab button
            local tabBtn = new("TextButton", {
                Parent = tabButtons,
                BackgroundColor3 = Theme.surface2,
                Size = UDim2.new(0, 100, 0, 35),
                Position = UDim2.new(0, (#self.tabs * 108), 0, 5),
                Text = name,
                TextColor3 = Theme.textMuted,
                Font = Enum.Font.GothamBold,
                TextSize = 14,
                AutoButtonColor = false,
                LayoutOrder = #self.tabs + 1
            })
            
            local tabBtnCorner = new("UICorner", {Parent = tabBtn, CornerRadius = UDim.new(0, 8)})
            local tabBtnStroke = new("UIStroke", {Parent = tabBtn, Color = Theme.accent, Thickness = 1, Transparency = 0.7})
            
            -- Page for this tab
            local page = new("ScrollingFrame", {
                Parent = pagesContainer,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, -20, 1, -20),
                Position = UDim2.new(0, 10, 0, 10),
                CanvasSize = UDim2.new(0, 0, 0, 0),
                ScrollBarThickness = 4,
                ScrollBarImageColor3 = Theme.accent,
                AutomaticCanvasSize = Enum.AutomaticSize.Y,
                Visible = (#self.tabs == 0),  -- First tab visible
                BorderSizePixel = 0
            })
            
            local pageLayout = new("UIListLayout", {
                Parent = page,
                Padding = UDim.new(0, 10),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            local pagePadding = new("UIPadding", {
                Parent = page,
                PaddingTop = UDim.new(0, 10),
                PaddingBottom = UDim.new(0, 10),
                PaddingLeft = UDim.new(0, 10),
                PaddingRight = UDim.new(0, 10)
            })
            
            -- Tab click
            tabBtn.MouseButton1Click:Connect(function()
                -- Hide all pages
                for _, p in ipairs(self.pages) do
                    p.Visible = false
                end
                -- Show this page
                page.Visible = true
                self.currentTab = name
                
                -- Update button colors
                for i, btnData in ipairs(self.tabs) do
                    if btnData.Button then
                        tween(btnData.Button, {BackgroundColor3 = Theme.surface2}, 0.15)
                        tween(btnData.Button, {TextColor3 = Theme.textMuted}, 0.15)
                    end
                end
                tween(tabBtn, {BackgroundColor3 = Theme.accent}, 0.15)
                tween(tabBtn, {TextColor3 = Theme.bg}, 0.15)
            end)
            
            -- Store tab
            table.insert(self.tabs, {Button = tabBtn, Name = name})
            table.insert(self.pages, page)
            
            local tabObj = {
                Name = name,
                Button = tabBtn,
                Page = page,
                Layout = pageLayout,
                
                -- Add Section
                Section = function(self, title)
                    local section = new("Frame", {
                        Parent = page,
                        BackgroundColor3 = Theme.surface2,
                        Size = UDim2.new(1, 0, 0, 0),
                        AutomaticSize = Enum.AutomaticSize.Y,
                        BorderSizePixel = 0
                    })
                    
                    local sectionCorner = new("UICorner", {Parent = section, CornerRadius = UDim.new(0, 10)})
                    
                    -- Yellow header line
                    if title then
                        local headerLine = new("Frame", {
                            Parent = section,
                            BackgroundColor3 = Theme.accent,
                            Size = UDim2.new(1, -20, 0, 2),
                            Position = UDim2.new(0, 10, 0, 30),
                            BorderSizePixel = 0
                        })
                        
                        local titleLabel = new("TextLabel", {
                            Parent = section,
                            BackgroundTransparency = 1,
                            Size = UDim2.new(1, -20, 0, 30),
                            Position = UDim2.new(0, 10, 0, 0),
                            Text = title,
                            TextColor3 = Theme.accent,
                            Font = Enum.Font.GothamBold,
                            TextSize = 16,
                            TextXAlignment = Enum.TextXAlignment.Left
                        })
                    end
                    
                    local sectionLayout = new("UIListLayout", {
                        Parent = section,
                        Padding = UDim.new(0, 6),
                        SortOrder = Enum.SortOrder.LayoutOrder
                    })
                    
                    local sectionPadding = new("UIPadding", {
                        Parent = section,
                        PaddingTop = UDim.new(0, title and 35 or 8),
                        PaddingBottom = UDim.new(0, 8),
                        PaddingLeft = UDim.new(0, 10),
                        PaddingRight = UDim.new(0, 10)
                    })
                    
                    local sec = {
                        -- Toggle
                        Toggle = function(self, opt)
                            opt = opt or {}
                            
                            local f = new("Frame", {
                                Parent = section,
                                BackgroundColor3 = Theme.surface,
                                Size = UDim2.new(1, 0, 0, 40),
                                BorderSizePixel = 0
                            })
                            
                            local fCorner = new("UICorner", {Parent = f, CornerRadius = UDim.new(0, 8)})
                            
                            -- Yellow accent line
                            local accentLine = new("Frame", {
                                Parent = f,
                                BackgroundColor3 = Theme.accent,
                                Size = UDim2.new(0, 3, 1, -10),
                                Position = UDim2.new(0, 0, 0.5, -5),
                                BorderSizePixel = 0
                            })
                            
                            local label = new("TextLabel", {
                                Parent = f,
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, -70, 1, 0),
                                Position = UDim2.new(0, 15, 0, 0),
                                Text = opt.Title or "Toggle",
                                TextColor3 = Theme.text,
                                Font = Enum.Font.Gotham,
                                TextSize = 14,
                                TextXAlignment = Enum.TextXAlignment.Left
                            })
                            
                            if opt.Description then
                                local desc = new("TextLabel", {
                                    Parent = f,
                                    BackgroundTransparency = 1,
                                    Size = UDim2.new(1, -70, 0, 16),
                                    Position = UDim2.new(0, 15, 0, 22),
                                    Text = opt.Description,
                                    TextColor3 = Theme.textMuted,
                                    Font = Enum.Font.Gotham,
                                    TextSize = 11,
                                    TextXAlignment = Enum.TextXAlignment.Left
                                })
                                f.Size = UDim2.new(1, 0, 0, 56)
                            end
                            
                            local btn = new("TextButton", {
                                Parent = f,
                                BackgroundColor3 = opt.Default and Theme.accent or Theme.surface,
                                Size = UDim2.new(0, 46, 0, 24),
                                Position = UDim2.new(1, -54, 0.5, -12),
                                Text = "",
                                AutoButtonColor = false
                            })
                            
                            local btnCorner = new("UICorner", {Parent = btn, CornerRadius = UDim.new(1, 0)})
                            
                            local circle = new("Frame", {
                                Parent = btn,
                                BackgroundColor3 = Color3.new(1,1,1),
                                Size = UDim2.new(0, 18, 0, 18),
                                Position = opt.Default and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9),
                                BorderSizePixel = 0
                            })
                            
                            local circleCorner = new("UICorner", {Parent = circle, CornerRadius = UDim.new(1, 0)})
                            
                            local state = opt.Default or false
                            local key = opt.Key or opt.Title
                            
                            -- Load saved state
                            if win.settings[key] ~= nil then
                                state = win.settings[key]
                                btn.BackgroundColor3 = state and Theme.accent or Theme.surface
                                circle.Position = state and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)
                            end
                            
                            btn.MouseButton1Click:Connect(function()
                                state = not state
                                tween(btn, {BackgroundColor3 = state and Theme.accent or Theme.surface}, 0.15)
                                tween(circle, {
                                    Position = state and UDim2.new(1, -20, 0.5, -9) or UDim2.new(0, 2, 0.5, -9)
                                }, 0.15)
                                
                                win.settings[key] = state
                                if opt.Callback then opt.Callback(state) end
                            end)
                            
                            return {Get = function() return state end}
                        end,
                        
                        -- Button
                        Button = function(self, opt)
                            opt = opt or {}
                            
                            local btn = new("TextButton", {
                                Parent = section,
                                BackgroundColor3 = Theme.surface,
                                Size = UDim2.new(1, 0, 0, 40),
                                Text = "",
                                AutoButtonColor = false
                            })
                            
                            local btnCorner = new("UICorner", {Parent = btn, CornerRadius = UDim.new(0, 8)})
                            local btnStroke = new("UIStroke", {Parent = btn, Color = Theme.accent, Thickness = 1, Transparency = 0.5})
                            
                            local label = new("TextLabel", {
                                Parent = btn,
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, -20, 1, 0),
                                Position = UDim2.new(0, 15, 0, 0),
                                Text = opt.Title or "Button",
                                TextColor3 = Theme.accent,
                                Font = Enum.Font.GothamBold,
                                TextSize = 15,
                                TextXAlignment = Enum.TextXAlignment.Left
                            })
                            
                            if opt.Description then
                                local desc = new("TextLabel", {
                                    Parent = btn,
                                    BackgroundTransparency = 1,
                                    Size = UDim2.new(1, -20, 0, 16),
                                    Position = UDim2.new(0, 15, 0, 22),
                                    Text = opt.Description,
                                    TextColor3 = Theme.textMuted,
                                    Font = Enum.Font.Gotham,
                                    TextSize = 11,
                                    TextXAlignment = Enum.TextXAlignment.Left
                                })
                                btn.Size = UDim2.new(1, 0, 0, 56)
                            end
                            
                            btn.MouseEnter:Connect(function()
                                tween(btn, {BackgroundColor3 = Theme.accent}, 0.15)
                                if label then
                                    tween(label, {TextColor3 = Theme.bg}, 0.15)
                                end
                            end)
                            
                            btn.MouseLeave:Connect(function()
                                tween(btn, {BackgroundColor3 = Theme.surface}, 0.15)
                                if label then
                                    tween(label, {TextColor3 = Theme.accent}, 0.15)
                                end
                            end)
                            
                            btn.MouseButton1Click:Connect(opt.Callback or function() end)
                            
                            return btn
                        end,
                        
                        -- Label
                        Label = function(self, opt)
                            opt = opt or {}
                            
                            return new("TextLabel", {
                                Parent = section,
                                BackgroundTransparency = 1,
                                Size = UDim2.new(1, 0, 0, opt.Height or 20),
                                Text = opt.Text or "",
                                TextColor3 = opt.Color or Theme.text,
                                Font = Enum.Font.Gotham,
                                TextSize = opt.Size or 14,
                                TextXAlignment = Enum.TextXAlignment.Left,
                                TextWrapped = true
                            })
                        end
                    }
                    
                    return sec
                end
            }
            
            return tabObj
        end,
        
        -- Select Tab
        SelectTab = function(self, name)
            for i, tab in ipairs(self.tabs) do
                if tab.Name == name and tab.Button then
                    tab.Button:Click()
                    break
                end
            end
        end,
        
        -- Save Settings
        SaveSettings = function(self, name)
            if SaveSettings(self.settings, name or "config") then
                Sponge:Notify({
                    Title = "üíæ Saved",
                    Content = "Settings saved successfully!"
                })
            else
                Sponge:Notify({
                    Title = "‚ö†Ô∏è Error",
                    Content = "Could not save settings (executor doesn't support file writing)"
                })
            end
        end,
        
        -- Load Settings
        LoadSettings = function(self, name)
            local data = LoadSettings(name or "config")
            if data then
                self.settings = data
                Sponge:Notify({
                    Title = "üìÇ Loaded",
                    Content = "Settings loaded successfully!"
                })
                return true
            else
                Sponge:Notify({
                    Title = "‚ö†Ô∏è Error",
                    Content = "No saved settings found"
                })
            end
            return false
        end
    }
    
    -- ===========================================
    -- DEFAULT INFO TAB (Made by Sponge Scripts)
    -- ===========================================
    local infoTab = win:Tab("üìå Info")
    local infoSection = infoTab:Section("About")
    
    infoSection:Label({
        Text = "üßΩ Sponge Library UI",
        Size = 22,
        Color = Theme.accent
    })
    
    infoSection:Label({
        Text = "Version " .. Sponge.Version,
        Size = 14,
        Color = Theme.textMuted
    })
    
    infoSection:Label({Text = ""})  -- Spacer
    
    infoSection:Label({
        Text = "Made by: Sponge Scripts",
        Size = 16,
        Color = Theme.accent
    })
    
    infoSection:Label({
        Text = "¬© 2024 All rights reserved",
        Size = 12,
        Color = Theme.textMuted
    })
    
    infoSection:Label({Text = ""})  -- Spacer
    
    infoSection:Label({
        Text = "Features:",
        Size = 16,
        Color = Theme.accent
    })
    
    infoSection:Label({Text = "‚úì Anti-Kick (20 min AFK protection)"})
    infoSection:Label({Text = "‚úì Server Hopper"})
    infoSection:Label({Text = "‚úì Save/Load Settings"})
    infoSection:Label({Text = "‚úì Mobile Friendly"})
    infoSection:Label({Text = "‚úì Black & Yellow Theme"})
    
    -- Anti-kick section
    local antiSection = infoTab:Section("Protection")
    
    antiSection:Toggle({
        Title = "Anti-Kick",
        Description = "Prevent being kicked for AFK",
        Default = true,
        Key = "AntiKick",
        Callback = function(state)
            if state then
                AntiKick:Start()
            else
                AntiKick:Stop()
            end
        end
    })
    
    antiSection:Button({
        Title = "Hop Server",
        Description = "Teleport to another server",
        Callback = function()
            Sponge:Notify({
                Title = "üîÑ Hopping...",
                Content = "Looking for new server"
            })
            HopServer()
        end
    })
    
    antiSection:Button({
        Title = "Save Settings",
        Description = "Save current configuration",
        Callback = function()
            win:SaveSettings()
        end
    })
    
    antiSection:Button({
        Title = "Load Settings",
        Description = "Load saved configuration",
        Callback = function()
            win:LoadSettings()
        end
    })
    
    -- Start anti-kick by default
    AntiKick:Start()
    
    return win
end

-- ===========================================
-- NOTIFICATION SYSTEM
-- ===========================================
function Sponge:Notify(opts)
    opts = opts or {}
    
    local parent = CoreGui or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    
    local gui = parent:FindFirstChild("SpongeNotifs")
    if not gui then
        gui = new("ScreenGui", {
            Name = "SpongeNotifs",
            Parent = parent,
            DisplayOrder = 1000,
            IgnoreGuiInset = true
        })
    end
    
    local notif = new("Frame", {
        Parent = gui,
        BackgroundColor3 = Theme.surface,
        Size = UDim2.new(0, 300, 0, 70),
        Position = UDim2.new(1, -320, 0, -90),
        BorderSizePixel = 0
    })
    
    local notifCorner = new("UICorner", {Parent = notif, CornerRadius = UDim.new(0, 12)})
    local notifStroke = new("UIStroke", {Parent = notif, Color = Theme.accent, Thickness = 1})
    
    -- Yellow line
    local yellowLine = new("Frame", {
        Parent = notif,
        BackgroundColor3 = Theme.accent,
        Size = UDim2.new(0, 4, 1, -20),
        Position = UDim2.new(0, 0, 0.5, -10),
        BorderSizePixel = 0
    })
    
    local titleLabel = new("TextLabel", {
        Parent = notif,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 20),
        Position = UDim2.new(0, 15, 0, 12),
        Text = opts.Title or "Sponge Library",
        TextColor3 = Theme.accent,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local contentLabel = new("TextLabel", {
        Parent = notif,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -20, 0, 30),
        Position = UDim2.new(0, 15, 0, 32),
        Text = opts.Content or "",
        TextColor3 = Theme.text,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    tween(notif, {Position = UDim2.new(1, -320, 0, 20)}, 0.3)
    task.wait(opts.Duration or 3)
    tween(notif, {Position = UDim2.new(1, -320, 0, -90)}, 0.3)
    task.wait(0.3)
    notif:Destroy()
end

return Sponge
